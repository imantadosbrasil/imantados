<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Imantados 2.0</title>
    <link rel="stylesheet" href="/styles.css" />
    <script defer src="/auth.config.js"></script>
    <script defer src="/auth-status.js"></script>
    <!-- Firebase compat para Firestore -->
    <script defer src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore-compat.js"></script>
    <!-- Módulo DB local -->
    <script defer src="/firebase-db.js"></script>
    <script src="/main.js" defer></script>
  </head>
  <body>
    <!-- Cabeçalho do site com navegação -->
    <header class="site-header" role="banner">
      <div class="header-inner">
        <a class="brand" href="/" aria-label="Ir para a página inicial">
          <img class="logo" src="/assets/logo-imantados.png" alt="Imantados" onerror="this.onerror=null; this.src='/assets/botao.png'" />
        </a>
        <div class="actions">
          <nav class="nav" aria-label="Navegação principal">
            <a class="nav-link" href="/empresa.html">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                <g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M3 21h18"/>
                  <path d="M6 21V7h6v14"/>
                  <path d="M14 21V11h6v10"/>
                  <path d="M8 9h2M8 13h2M8 17h2"/>
                  <path d="M16 13h2M16 17h2"/>
                </g>
              </svg>
              <span>Empresa</span>
            </a>
            <a class="cta-mural" href="/mural.html" aria-label="Mural Imantados">
              Mural
            </a>
            <a class="nav-link" href="/login.html">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                <g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="7" r="3"/>
                  <path d="M5 21c0-4 3-7 7-7s7 3 7 7"/>
                </g>
              </svg>
              <span>Entrar</span>
            </a>
            <a class="nav-link" href="/carrinho.html">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                <g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M6 6h15l-2 7H8L6 6z"/>
                  <circle cx="9" cy="19" r="2"/>
                  <circle cx="18" cy="19" r="2"/>
                </g>
              </svg>
              <span>Carrinho</span>
              <span class="cart-count-badge" data-cart-count>0</span>
            </a>
          </nav>
          <div class="cta-group">
            <a class="cta cta-secondary" href="/modelos.html" aria-label="Exemplos">
              <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                <g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="4" y="4" width="7" height="7" rx="1"/>
                  <rect x="13" y="4" width="7" height="7" rx="1"/>
                  <rect x="4" y="13" width="7" height="7" rx="1"/>
                  <rect x="13" y="13" width="7" height="7" rx="1"/>
                </g>
              </svg>
              <span>Exemplos</span>
            </a>
          </div>
        </div>
      </div>
    </header>

    <!-- Banner Mural Imantados -->
    <section class="mural-banner" aria-label="Veja o Mural Imantados">
      <a href="/mural.html" class="mural-banner-link">
        <img src="/assets/eles_ja_estao.png" alt="Eles já estão — veja o Mural Imantados" class="mural-banner-img" onerror="this.onerror=null; this.src='/assets/botao.png'" />
      </a>
    </section>

    <!-- Balão promocional topo direito -->
    <aside class="promo-bubble has-image" aria-label="Motivação para criar seus ímãs">
      <button class="promo-bubble-close" aria-label="Fechar">×</button>
      <img class="promo-bubble-img" src="/assets/balao.png" alt="Seu momento, sua frase, seu ímã! Personalize agora e veja sua geladeira ganhar vida." onerror="this.onerror=null; this.src='/assets/botao.png'" />
    </aside>

    <!-- Ações rápidas na lateral esquerda -->
    <aside class="side-actions" aria-label="Ações rápidas">
      <!-- Botão de enviar arquivos -->
      <button id="uploadBtn" class="upload-btn" type="button" aria-label="Enviar arquivos">
        <svg class="icon icon-upload" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
          <polyline points="17 8 12 3 7 8" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
          <line x1="12" y1="3" x2="12" y2="15" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"/>
        </svg>
        <span class="btn-text">
          <strong>Enviar arquivos</strong>
          <span>Escolher imagens</span>
        </span>
      </button>

      <!-- Categorias de modelos pré-definidos -->
      <nav class="quick-categories" aria-label="Modelos pré-definidos">
        <a class="category-btn" href="https://github.com/imantadosbrasil/imantados/tree/main/assets/EMOJIS" target="_blank" rel="noopener" data-category="Emojis">Emojis</a>
        <a class="category-btn" href="#" data-category="Figurinhas">Figurinhas</a>
        <a class="category-btn" href="#" data-category="Whatsapp">Whatsapp</a>
        <a class="category-btn" href="#" data-category="Instagram">Instagram</a>
        <a class="category-btn" href="#" data-category="X">X</a>
        <a class="category-btn" href="#" data-category="Quadrinhos">Quadrinhos</a>
        <a class="category-btn" href="#" data-category="Frases">Frases</a>
        <a class="category-btn" href="#" data-category="Signos">Signos</a>
      </nav>
    </aside>

    <!-- Modal de seleção de modelos -->
    <div id="categoryModal" class="modal-backdrop visually-hidden" aria-hidden="true">
      <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="categoryModalTitle">
        <header class="modal-header">
          <h2 id="categoryModalTitle" class="modal-title">Selecione um modelo</h2>
          <button class="modal-close" type="button" aria-label="Fechar">×</button>
        </header>
        <div id="categoryOptions" class="modal-grid" role="list"></div>
      </div>
    </div>

    <!-- Botão de enviar para o carrinho -->
    <button id="previewBtn" class="preview-btn" type="button" aria-label="Enviar para o carrinho">
      <svg class="icon" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
        <path fill="currentColor" d="M7 18a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm10 0a2 2 0 1 0 .001 3.999A2 2 0 0 0 17 18zM6.2 6h13.03a1 1 0 0 1 .98 1.2l-1.4 7a1 1 0 0 1-.98.8H9.12l-.32 1.6h9.2a1 1 0 1 1 0 2H8a1 1 0 0 1-.98-1.2l.54-2.7L5.2 5H3a1 1 0 1 1 0-2h2.8a1 1 0 0 1 .93.64L7 6z"/>
      </svg>
      <span class="preview-label">Enviar para o carrinho</span>
    </button>

    <!-- Input de arquivo oculto -->
    <input id="fileInput" class="visually-hidden" type="file" accept=".png,.jpg,.jpeg,.webp,image/*" multiple />

    <!-- Área de mensagens/toast -->
    <div id="toast" class="toast" aria-live="polite" aria-atomic="true"></div>

    <!-- Palco central onde as imagens escolhidas aparecem -->
    <main id="stage" class="stage">
      <div id="gallery" class="gallery"></div>
  </main>
  
  <!-- Seção de figurinhas do WhatsApp removida conforme solicitado -->
  </body>
  <script src="/cart-count.js" defer></script>
  <script>
    // Ao carregar a página, se o balão já foi fechado antes, removê-lo
    document.addEventListener('DOMContentLoaded', function () {
      try {
        if (localStorage.getItem('promoBubbleClosed') === '1') {
          const bubble = document.querySelector('.promo-bubble');
          if (bubble) bubble.remove();
        }
      } catch {}
    });
    // Fechar balão ao clicar no botão "×"
    document.addEventListener('click', function (e) {
      if (e.target && e.target.classList && e.target.classList.contains('promo-bubble-close')) {
        const bubble = document.querySelector('.promo-bubble');
        if (bubble) bubble.remove();
        try { localStorage.setItem('promoBubbleClosed', '1'); } catch {}
      }
    });
  </script>
  <script type="module">
    // Inicializa Firebase (SDK modular via CDN) e carrega Analytics dinamicamente só em produção
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js';
    try {
      const app = initializeApp(window.FIREBASE_CONFIG);
      const allowedHosts = ['imantados.com.br', 'www.imantados.com.br'];
      const isProdHost = allowedHosts.includes(location.hostname);
      const hasMeasurement = !!(window.FIREBASE_CONFIG && window.FIREBASE_CONFIG.measurementId);
      if (isProdHost && hasMeasurement) {
        (async () => {
          try {
            const mod = await import('https://www.gstatic.com/firebasejs/10.13.0/firebase-analytics.js');
            const ok = await mod.isSupported();
            if (ok) mod.getAnalytics(app);
          } catch (e) {
            console.info('Analytics não iniciado:', e?.message || e);
          }
        })();
      } else {
        console.info('Analytics desativado (host não permitido)');
      }
    } catch (e) {
      console.warn('Firebase init (index) aviso:', e?.message || e);
    }
  </script>
  </html>
